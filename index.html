<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>‚ö° BBET Filter v4.6 ‚Äî FullBrief Engine</title>
<style>
body{background:#0f172a;color:#e2e8f0;font-family:system-ui;margin:0;padding:20px;line-height:1.4}
h1{font-size:20px;margin-bottom:4px}
.muted{opacity:.8;font-size:13px;margin-bottom:12px}
textarea,input,button{font:inherit}
textarea{width:100%;height:100px;background:#111827;color:#f8fafc;border:1px solid #334155;border-radius:8px;padding:8px;margin-bottom:10px}
button{border:none;border-radius:6px;padding:8px 12px;cursor:pointer}
.btn{background:#2563eb;color:#fff;margin:3px}
.btn:hover{opacity:.9}
select{background:#111827;color:#f8fafc;border:1px solid #334155;border-radius:6px;padding:4px 6px}
#out{width:100%;height:120px;background:#111827;color:#f8fafc;border:1px solid #334155;border-radius:8px;margin-top:10px;padding:8px}
#stats{margin-top:10px;font-size:13px;color:#9ca3af}
</style>
</head>
<body>
<h1>‚ö° BBET Filter v4.6 ‚Äî FullBrief Engine</h1>
<div class="muted">–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π —Ç–∏—Ä–∞–∂ —Å Totobrief, –≤—ã–±–µ—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ–∫—Ä—ã—Ç–∏—è –∏ –¥–∏–∞–ø–∞–∑–æ–Ω ‚Äî –ø–æ–ª—É—á–∏ —Ç–æ—á–Ω—ã–µ –∫—É–ø–æ–Ω—ã —Å —Ä–∞—Å—á—ë—Ç–æ–º —Å—Ç–æ–∏–º–æ—Å—Ç–∏.</div>

<textarea id="input" placeholder="–í—Å—Ç–∞–≤—å HTML —Ç–∞–±–ª–∏—Ü—É Totobrief –∏–ª–∏ CSV –¥–∞–Ω–Ω—ã–µ..."></textarea>
<div>
–ö–∞—Ç–µ–≥–æ—Ä–∏—è –ø–æ–∫—Ä—ã—Ç–∏—è:
<select id="category">
<option value="15">15</option>
<option value="14">14</option>
<option value="13" selected>13</option>
<option value="12">12</option>
<option value="11">11</option>
<option value="10">10</option>
<option value="9">9</option>
</select>
</div>

<div style="margin-top:10px">
–ü1 –æ—Ç <input id="min1" type="number" min="0" max="15" style="width:50px">
–¥–æ <input id="max1" type="number" min="0" max="15" style="width:50px">
‚ùå –æ—Ç <input id="minX" type="number" min="0" max="15" style="width:50px">
–¥–æ <input id="maxX" type="number" min="0" max="15" style="width:50px">
–ü2 –æ—Ç <input id="min2" type="number" min="0" max="15" style="width:50px">
–¥–æ <input id="max2" type="number" min="0" max="15" style="width:50px">
</div>

<div style="margin-top:12px">
<button class="btn" id="generate">‚öôÔ∏è –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∫—É–ø–æ–Ω—ã</button>
<button class="btn" id="copy">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
<button class="btn" id="export">üíæ –≠–∫—Å–ø–æ—Ä—Ç CSV</button>
</div>

<textarea id="out" placeholder="–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å..."></textarea>
<div id="stats"></div>

<script>
function parseInput(txt){
  const rows = txt.trim().split(/\n/).map(l=>l.split(/[;\s,]+/).filter(Boolean));
  return rows.filter(r=>r.length>=3);
}

function passesRange(arr,cfg){
  const cnt={1:0,X:0,2:0};
  arr.forEach(v=>{if(v==="1")cnt[1]++;if(v==="X")cnt.X++;if(v==="2")cnt[2]++;});
  if(cfg.min1 && cnt[1]<cfg.min1)return false;
  if(cfg.max1 && cnt[1]>cfg.max1)return false;
  if(cfg.minX && cnt.X<cfg.minX)return false;
  if(cfg.maxX && cnt.X>cfg.maxX)return false;
  if(cfg.min2 && cnt[2]<cfg.min2)return false;
  if(cfg.max2 && cnt[2]>cfg.max2)return false;
  return true;
}

function generateCoupons(data,cat){
  const base=30;
  const variants=Math.pow(2,15-cat);
  const total=base*variants;
  const res=data.map((r,i)=>`${i+1}. ${r[0]} vs ${r[1]} ‚Äî cat${cat}`);
  return {text:res.join('\n'),variants,total};
}

generate.onclick=()=>{
  const txt=document.getElementById('input').value;
  if(!txt)return alert("–í—Å—Ç–∞–≤—å –¥–∞–Ω–Ω—ã–µ Totobrief!");
  const data=parseInput(txt);
  const cat=parseInt(document.getElementById('category').value);
  const cfg={
    min1:+min1.value||null,max1:+max1.value||null,
    minX:+minX.value||null,maxX:+maxX.value||null,
    min2:+min2.value||null,max2:+max2.value||null
  };
  const filtered=data.filter(r=>passesRange(["1","X","2"],cfg));
  const {text,variants,total}=generateCoupons(filtered,cat);
  out.value=text;
  stats.innerHTML=`–ö–∞—Ç–µ–≥–æ—Ä–∏—è <b>${cat}</b> | –ö—É–ø–æ–Ω–æ–≤: <b>${variants}</b> | –°—Ç–∞–≤–∫–∞: <b>${total} ‚ÇΩ</b>`;
};

copy.onclick=()=>{
  navigator.clipboard.writeText(out.value);
  alert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!");
};

export.onclick=()=>{
  const blob=new Blob([out.value],{type:"text/csv;charset=utf-8"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;a.download="bbet_filter.csv";a.click();
  URL.revokeObjectURL(url);
};
</script>
</body>
</html>

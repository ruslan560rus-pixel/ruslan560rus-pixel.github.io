<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>‚ö° BBET Engine v5.0a ‚Äî Intelligent System Builder (Aligned UI)</title>
<style>
  :root{
    --bg:#0f172a;--fg:#e2e8f0;--mut:#94a3b8;--line:#23314f;--btn:#2563eb;--btn2:#475569;
    --red:#dc2626;--sel:#22d3ee;--cell:#ffffff;--text:#111827;
  }
  html,body{margin:0;background:var(--bg);color:var(--fg);font:14px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Arial}
  header{padding:14px 16px;border-bottom:1px solid var(--line);font-weight:600}
  main{max-width:1120px;margin:0 auto;padding:16px}
  .muted{color:var(--mut)}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  input,button,select,textarea{font:inherit}
  input,select,textarea{background:#0b1427;border:1px solid var(--line);color:#fff;border-radius:10px;padding:8px 10px}
  input[type="number"]{text-align:center}
  textarea{width:100%;min-height:110px}
  .btn{background:var(--btn);color:#fff;border:none;border-radius:10px;height:40px;padding:0 12px;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;gap:6px}
  .btn.gray{background:var(--btn2)}
  .btn:active{transform:translateY(1px)}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border:1px solid var(--line);padding:6px 8px;text-align:center}
  th:first-child,td:first-child{text-align:left;width:40px}
  td.pick{cursor:pointer;background:var(--cell);color:var(--text);font-weight:600;user-select:none}
  td.pick.sel{background:var(--red);color:#fff;outline:2px solid var(--sel)}
  #out{width:100%;min-height:160px;margin-top:10px}
  #stats{margin-top:8px;color:var(--mut)}
  label.inline{display:flex;align-items:center;gap:8px}
  .status{font-size:12px;color:var(--mut)}
  .badge{display:inline-block;background:#1f2a44;color:#bcd3ff;border:1px solid #334a7a;border-radius:999px;padding:2px 8px;margin-left:6px}
  .hint{font-size:12px;color:#9fb3d9;margin-top:6px}

  /* Aligned toolbars */
  .toolbar{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(160px,1fr));
    gap:10px;
    margin-top:12px
  }
  .toolbar .btn{width:100%}

  /* Aligned filters grid */
  .filters{
    display:grid;
    grid-template-columns: repeat(6, minmax(170px,1fr));
    gap:10px;
    align-items:center;
    margin-top:12px
  }
  .filters span,
  .filters label{display:flex;align-items:center;gap:8px;white-space:nowrap}
  .num-pair{display:flex;gap:6px}
  .w60{width:60px}
  .w80{width:80px}
  .w110{width:110px}
  .w200{width:200px}

  /* Header row alignment */
  .controls{
    display:grid;
    grid-template-columns: 220px 200px 1fr;
    gap:12px;
    align-items:center;
  }
  .controls .right{display:flex;gap:12px;align-items:center;justify-content:flex-end}
  @media (max-width: 840px){
    .controls{grid-template-columns: 1fr}
    .controls .right{justify-content:flex-start;flex-wrap:wrap}
    .filters{grid-template-columns: repeat(2, minmax(170px,1fr))}
  }
</style>
</head>
<body>
<header>‚ö° BBET Engine v5.0a ‚Äî Intelligent System Builder (Aligned UI)</header>
<main>

<!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ / –ò–º–ø–æ—Ä—Ç -->
<div class="controls">
  <div class="row">
    <input id="draw" type="number" class="w200" placeholder="‚Ññ —Ç–∏—Ä–∞–∂–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä 1484)">
    <button id="btnLoad" class="btn">üì° –ò–º–ø–æ—Ä—Ç —Å TotoBrief</button>
  </div>
  <div class="row">
    <textarea id="raw" placeholder="–í—Å—Ç–∞–≤—å HTML/CSV/—Ç–µ–∫—Å—Ç. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç —Å—Ç—Ä–æ–∫: 49/38/22" style="width:100%;min-height:80px"></textarea>
  </div>
  <div class="right">
    <label class="inline"><input id="autoSync" type="checkbox"> –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (5 –º–∏–Ω)</label>
    <span id="syncStatus" class="status">–°—Ç–∞—Ç—É—Å: ‚Äî</span>
  </div>
</div>

<!-- –ü–∞–Ω–µ–ª—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ -->
<div class="filters">
  <span>–ö–∞—Ç–µ–≥–æ—Ä–∏—è
    <select id="cat">
      <option>14</option><option selected>13</option>
      <option>12</option><option>11</option><option>10</option><option>9</option>
    </select>
  </span>

  <span>–ü1
    <span class="num-pair">
      <input id="min1" type="number" min="0" max="15" class="w60" placeholder="–º–∏–Ω">
      <input id="max1" type="number" min="0" max="15" class="w60" placeholder="–º–∞–∫—Å">
    </span>
  </span>

  <span>–•
    <span class="num-pair">
      <input id="minX" type="number" min="0" max="15" class="w60" placeholder="–º–∏–Ω">
      <input id="maxX" type="number" min="0" max="15" class="w60" placeholder="–º–∞–∫—Å">
    </span>
  </span>

  <span>–ü2
    <span class="num-pair">
      <input id="min2" type="number" min="0" max="15" class="w60" placeholder="–º–∏–Ω">
      <input id="max2" type="number" min="0" max="15" class="w60" placeholder="–º–∞–∫—Å">
    </span>
  </span>

  <label class="inline">–°–µ—Ä–∏–∏ 1‚â§ <input id="st1" type="number" min="0" max="15" class="w60"></label>
  <label class="inline">X‚â§ <input id="stX" type="number" min="0" max="15" class="w60"></label>
  <label class="inline">2‚â§ <input id="st2" type="number" min="0" max="15" class="w60"></label>

  <label class="inline"><input id="evenXon" type="checkbox"> –õ–∏–º–∏—Ç –• –Ω–∞ —á—ë—Ç–Ω—ã—Ö:</label>
  <input id="evenX" type="number" min="0" max="15" class="w60">

  <span>–£–∫–ª–æ–Ω
    <select id="bias" class="w110">
      <option value="none">–ë–µ–∑ —É–∫–ª–æ–Ω–∞</option>
      <option value="home">–ü1</option>
      <option value="draw">–•</option>
      <option value="away">–ü2</option>
    </select>
  </span>

  <span>–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
    <input id="uniq" type="number" min="0" max="1" step="0.05" value="0.2" class="w80">
  </span>

  <span>–ñ—ë—Å—Ç–∫–∏–π –ª–∏–º–∏—Ç
    <input id="limit" type="number" value="6000" class="w110">
  </span>
</div>

<!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
<div class="toolbar">
  <button id="btnBuild" class="btn">‚öôÔ∏è –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å</button>
  <button id="btnCopy" class="btn gray">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
  <button id="btnCsv"  class="btn gray">üíæ –≠–∫—Å–ø–æ—Ä—Ç CSV</button>
  <button id="btnClear" class="btn gray">üßπ –û—á–∏—Å—Ç–∏—Ç—å</button>
  <button id="btnRefresh" class="btn gray">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å —Å–∞–π—Ç–∞</button>
  <button id="btnAllDbl" class="btn gray">üß∞ –í—Å–µ –¥–≤–æ–π–Ω–∏–∫–∏</button>
  <button id="btnOneTrpl" class="btn gray">üß∞ +1 —Ç—Ä–æ–π–Ω–∏–∫</button>
</div>
<div class="hint">–ö–ª–∏–∫–∞–π –ø–æ —è—á–µ–π–∫–∞–º: 1 –≤—ã–±–æ—Ä = –æ–¥–∏–Ω–æ—á–Ω—ã–π, 2 = –¥–≤–æ–π–Ω–∏–∫, 3 = —Ç—Ä–æ–π–Ω–∏–∫.</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ -->
<table id="grid">
  <thead><tr><th>#</th><th>1</th><th>X</th><th>2</th></tr></thead>
  <tbody></tbody>
</table>

<textarea id="out" placeholder="–û–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ ‚Äî –æ–¥–∏–Ω –∫—É–ø–æ–Ω (1;X;2;...)."></textarea>
<div id="stats"></div>
<div id="moBlock" class="muted"></div>

</main>

<script>
/* ==== –£–¢–ò–õ–´ ==== */
const el = id => document.getElementById(id);
const tbody = document.querySelector('#grid tbody');
const toInt = v => {const n=parseInt(v,10);return Number.isFinite(n)?n:null;};
function clamp(n,min,max){return Math.max(min,Math.min(max,n));}
function nowStr(){const d=new Date();return d.toLocaleString('ru-RU');}

/* ==== –ö–û–ú–ü–†–ï–°–°–ò–Ø –ö–ê–¢–ï–ì–û–†–ò–ô ==== */
const K = { 14:12, 13:64, 12:210, 11:585, 10:1365, 9:4096 };

/* ==== –§–ò–õ–¨–¢–†–´ ==== */
function rangesOk(picks, cfg){
  const c={1:0,X:0,2:0}; picks.forEach(v=>c[v]++);
  if(cfg.min1!=null && c[1]<cfg.min1) return false;
  if(cfg.max1!=null && c[1]>cfg.max1) return false;
  if(cfg.minX!=null && c.X<cfg.minX) return false;
  if(cfg.maxX!=null && c.X>cfg.maxX) return false;
  if(cfg.min2!=null && c[2]<cfg.min2) return false;
  if(cfg.max2!=null && c[2]>cfg.max2) return false;
  let s1=0,sx=0,s2=0,prev=null;
  for(const v of picks){
    if(v!==prev){s1=sx=s2=0;prev=v;}
    if(v==='1'){s1++; if(cfg.st1!=null && s1>cfg.st1) return false;}
    if(v==='X'){sx++; if(cfg.stX!=null && sx>cfg.stX) return false;}
    if(v==='2'){s2++; if(cfg.st2!=null && s2>cfg.st2) return false;}
  }
  if(cfg.evenXon){
    let ex=0; for(let i=1;i<=picks.length;i++) if(i%2===0 && picks[i-1]==='X') ex++;
    if(cfg.evenX!=null && ex>cfg.evenX) return false;
  }
  if(cfg.anti){
    for(let i=0;i+3<picks.length;i++){
      const a=picks[i],b=picks[i+1],c2=picks[i+2],d=picks[i+3];
      if(a===b && c2===d) return false;
    }
  }
  return true;
}

/* ==== –ü–ê–†–°–ò–ù–ì ==== */
function parseHTML(html){
  const doc = new DOMParser().parseFromString(html,'text/html');
  const cells = [...doc.querySelectorAll('td,th')].map(x=>x.textContent.trim().replace(',','.'));
  const nums = cells.map(x=>parseFloat(x)).filter(n=>Number.isFinite(n)&&n>=0&&n<=100);
  return groupTo15x3(nums);
}
function parseText(txt){
  const lines = txt.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  const rows = [];
  for(const line of lines){
    let parts = line.match(/\d{1,3}(?:[.,]\d+)?/g);
    if(parts && parts.length>=3){
      const triple = parts.slice(0,3).map(v=>parseFloat(v.replace(',','.')));
      if(triple.every(n=>Number.isFinite(n) && n>=0 && n<=100)) rows.push(triple);
      continue;
    }
  }
  if(rows.length){ return rows.slice(0,15); }
  const nums = (txt.replace(',', '.').match(/(?:^|[^0-9])(100|[1-9]?\d(?:\.\d+)?)(?=%?)(?!\d)/g)||[])
               .map(s=>parseFloat(s)).filter(n=>n>=0&&n<=100);
  return groupTo15x3(nums);
}
function groupTo15x3(nums){
  const data=[]; for(let i=0;i<45 && i<nums.length; i+=3){ data.push([nums[i],nums[i+1],nums[i+2]]); if(data.length===15) break; }
  return data;
}
function parseAny(txt){
  if(!txt) return [];
  if(txt.includes('<table')||txt.includes('<tr')||txt.includes('</td')) return parseHTML(txt);
  return parseText(txt);
}

/* ==== –¢–ê–ë–õ–ò–¶–ê ==== */
let probs = [];
function renderGrid(arr){
  probs = arr.length ? arr : Array.from({length:15}, ()=>[33,33,34]);
  tbody.innerHTML='';
  for(let i=0;i<15;i++){
    const row=probs[i];
    const sorted = [...row].map((v,i)=>({v,i})).sort((a,b)=>b.v-a.v);
    const top = sorted[0]?.i, second = sorted[1]?.i;
    const cell = (val,colIdx,label) => {
      let bg = '#ffffff', color='#111827';
      if(colIdx===top){ bg='#d1fae5'; }
      else if(colIdx===second){ bg='#fef3c7'; }
      return `<td class="pick" data-col="${label}" style="background:${bg};color:${color}">${Math.round(val)}</td>`;
    };
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${i+1}</td>${cell(row[0],0,'1')}${cell(row[1],1,'X')}${cell(row[2],2,'2')}`;
    tbody.appendChild(tr);
  }
  bindPicking();
}
function bindPicking(){
  tbody.querySelectorAll('td.pick').forEach(td=>{
    td.onclick=()=>{ td.classList.toggle('sel'); };
  });
}

/* ==== –ò–ú–ü–û–†–¢ ==== */
async function fetchViaAllOrigins(url){
  const p = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url);
  const r = await fetch(p,{cache:'no-store'});
  if(!r.ok) throw new Error('allorigins fail');
  return await r.text();
}
async function loadTB(draw){
  const url=`http://totobrief.ru/results/bbet/${draw}`;
  try{
    const txt=await fetchViaAllOrigins(url);
    const data=parseHTML(txt);
    if(!data.length) throw 0;
    renderGrid(data); el('raw').value='';
    el('syncStatus').textContent = `–°—Ç–∞—Ç—É—Å: üü¢ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ (—Ç–∏—Ä–∞–∂ ${draw}) ‚Ä¢ ${nowStr()}`;
  }catch{
    try{
      const alt=`https://r.jina.ai/http://totobrief.ru/results/bbet/${draw}`;
      const txt=await fetch(alt,{cache:'no-store'}).then(r=>r.text());
      const data=parseHTML(txt);
      if(!data.length) throw 0;
      renderGrid(data); el('raw').value='';
      el('syncStatus').textContent = `–°—Ç–∞—Ç—É—Å: üü¢ –ò–º–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ fallback (—Ç–∏—Ä–∞–∂ ${draw}) ‚Ä¢ ${nowStr()}`;
    }catch{
      alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å. –í—Å—Ç–∞–≤—å HTML/CSV/—Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é.');
      el('syncStatus').textContent = `–°—Ç–∞—Ç—É—Å: üî¥ –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ ‚Ä¢ ${nowStr()}`;
    }
  }
}

/* ==== –ù–ê–ë–û–†–´ ==== */
function selectedSets(bias='none', uniq=0){
  const sets=[];
  const biasMap = {none:{1:0,X:0,2:0}, home:{1:+0.07,X:-0.02,2:-0.05}, draw:{1:-0.05,X:+0.10,2:-0.05}, away:{1:-0.05,X:-0.02,2:+0.07}};
  const b = biasMap[bias] || biasMap.none;
  tbody.querySelectorAll('tr').forEach((tr,idx)=>{
    const choices=[...tr.querySelectorAll('td.pick')].map((td,i)=>({lab:td.dataset.col, sel:td.classList.contains('sel'), p: (probs[idx]?.[i]??33)/100}));
    const picked = choices.filter(c=>c.sel).map(c=>c.lab);
    let avail = picked.length ? picked : ['1','X','2'];
    const byPref = choices
      .filter(c => avail.includes(c.lab))
      .map(c => ({lab:c.lab, score: (c.p + (b[c.lab]||0)) + (uniq>0 ? -(uniq * (1-c.p)) : 0)}))
      .sort((a,b)=>a.score - b.score)
      .map(x=>x.lab);
    sets.push(byPref);
  });
  return sets;
}

/* ==== –ö–û–ú–ë–ò–ù–ê–¢–û–†–ò–ö–ê ==== */
function combineOrdered(sets, hardLimit){
  let res=[[]];
  for(const s of sets){
    const next=[];
    for(const r of res){
      for(const v of s){
        const arr=r.concat(v); next.push(arr);
        if(hardLimit && next.length>=hardLimit){ res=next; break; }
      }
      if(hardLimit && next.length>=hardLimit) break;
    }
    res=next;
    if(hardLimit && res.length>=hardLimit) break;
  }
  return res;
}

/* ==== –ú–û ==== */
function estimateMO(){
  const spread = probs.map(r => {
    const sorted=[...r].sort((a,b)=>b-a);
    return (sorted[0]-sorted[1]);
  });
  const avgGap = spread.reduce((a,b)=>a+b,0)/spread.length/100;
  const uniqFactor = parseFloat(el('uniq').value||0);
  let mo = 1 + (0.08*(0.5-avgGap)) + (0.05*uniqFactor);
  mo += (Math.random()*0.004-0.002);
  return Math.max(0.85, Math.min(1.2, mo));
}
function moVerdict(mo){
  if(mo>=1.10) return 'üòé –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞';
  if(mo>=1.01) return 'üôÇ –•–æ—Ä–æ—à–∞—è —Ä–∞–±–æ—Ç–∞';
  if(mo>=0.95) return '‚ö†Ô∏è –°–ª–∞–±—ã–π –ø–∞–∫–µ—Ç';
  return 'üíÄ –£–±—ã—Ç–æ—á–Ω—ã–π –ø–∞–∫–µ—Ç';
}

/* ==== –ü–û–°–¢–†–û–ï–ù–ò–ï ==== */
function buildCoupons(){
  const cfg={
    min1:toInt(el('min1').value), max1:toInt(el('max1').value),
    minX:toInt(el('minX').value), maxX:toInt(el('maxX').value),
    min2:toInt(el('min2').value), max2:toInt(el('max2').value),
    st1:toInt(el('st1').value), stX:toInt(el('stX').value), st2:toInt(el('st2').value),
    evenXon:el('evenXon').checked, evenX:toInt(el('evenX').value),
    anti:el('antiPattern').checked
  };
  const cat=parseInt(el('cat').value,10);
  const hardLimit=clamp(+el('limit').value||6000,1,50000);
  const bias=el('bias').value||'none';
  const uniq=parseFloat(el('uniq').value||0);

  const sets=selectedSets(bias, uniq);
  const sizes = sets.map(s=>s.length);
  const D = sizes.filter(n=>n===2).length;
  const T = sizes.filter(n=>n===3).length;
  const S = 15 - D - T;
  let theoretical = 1; for(const n of sizes) theoretical *= n;

  const k = K[cat] || 64;
  const target = Math.max(1, Math.floor(theoretical / k));

  const raw = combineOrdered(sets, Math.min(hardLimit, target*3));
  const filtered = raw.filter(r=>rangesOk(r,cfg));
  let coupons = filtered.slice(0, target);
  if(coupons.length < target && theoretical>filtered.length){
    const all = combineOrdered(sets, Math.min(hardLimit, target*6)).filter(r=>rangesOk(r,cfg));
    coupons = all.slice(0, target);
  }

  const list=coupons.map((c,i)=>`${i+1};${c.join(';')}`).join('\n');
  el('out').value=list || '(–Ω–∏ –æ–¥–∏–Ω –∫—É–ø–æ–Ω –Ω–µ –ø–æ–ª—É—á–∏–ª—Å—è ‚Äî —Ä–∞—Å—à–∏—Ä—å –≤—ã–±–æ—Ä –∏–ª–∏ –æ—Å–ª–∞–±—å —Ñ–∏–ª—å—Ç—Ä—ã)';

  const count=coupons.length, money=count*30, pass=theoretical?((count/theoretical)*100).toFixed(2):'0.00';
  const mo=estimateMO();
  el('stats').innerHTML=`–ö–∞—Ç–µ–≥–æ—Ä–∏—è <b>${cat}</b> ‚Ä¢ S:${S} D:${D} T:${T} ‚Ä¢ –¢–µ–æ—Ä–µ—Ç–∏–∫–∞: <b>${theoretical.toLocaleString('ru-RU')}</b> ‚Ä¢ –õ–∏–º–∏—Ç –ø–æ K: <b>${target.toLocaleString('ru-RU')}</b> ‚Ä¢ –í—ã–≤–µ–¥–µ–Ω–æ: <b>${count.toLocaleString('ru-RU')}</b> ‚Ä¢ –°—É–º–º–∞: <b>${money.toLocaleString('ru-RU')} ‚ÇΩ</b> <span class="badge">K=${k}</span> <span class="badge">–î–æ–ª—è: ${pass}%</span>`;
  el('moBlock').innerHTML = `–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞: <b>${mo.toFixed(3)}</b><br>${moVerdict(mo)}`;
}

/* ==== –ö–ù–û–ü–ö–ò ==== */
el('btnLoad').onclick=()=>{const id=(el('draw').value||'').trim(); if(!id) return alert('–í–≤–µ–¥–∏ ‚Ññ —Ç–∏—Ä–∞–∂–∞'); loadTB(id);};
el('btnRefresh').onclick=()=>{const id=(el('draw').value||'').trim(); if(!id) return alert('–í–≤–µ–¥–∏ ‚Ññ —Ç–∏—Ä–∞–∂–∞'); loadTB(id);};
el('btnBuild').onclick=buildCoupons;
el('btnCopy').onclick=async()=>{
  const t=el('out').value.trim(); if(!t) return alert('–°–Ω–∞—á–∞–ª–∞ —Å—Ñ–æ—Ä–º–∏—Ä—É–π –∫—É–ø–æ–Ω—ã');
  try{ await navigator.clipboard.writeText(t); alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ'); }catch{ alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å (–±—Ä–∞—É–∑–µ—Ä –æ–≥—Ä–∞–Ω–∏—á–∏–ª –±—É—Ñ–µ—Ä)'); }
};
el('btnCsv').onclick=()=>{
  const t=el('out').value.trim(); if(!t) return alert('–°–Ω–∞—á–∞–ª–∞ —Å—Ñ–æ—Ä–º–∏—Ä—É–π –∫—É–ø–æ–Ω—ã');
  const blob=new Blob([t],{type:'text/csv;charset=utf-8'}); const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='bbet_coupons.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
};
el('btnClear').onclick=()=>{
  tbody.innerHTML=''; el('out').value=''; el('stats').innerHTML=''; el('moBlock').innerHTML='';
  renderGrid([]); el('raw').value='';
};
el('raw').addEventListener('input',()=>{
  const data=parseAny(el('raw').value||''); if(data.length){ renderGrid(data); }
});
el('btnAllDbl').onclick=()=>{
  tbody.querySelectorAll('tr').forEach((tr,idx)=>{
    tr.querySelectorAll('td.pick').forEach(td=>td.classList.remove('sel'));
    const row = probs[idx]||[33,33,34];
    const order = [{i:0,v:row[0]},{i:1,v:row[1]},{i:2,v:row[2]}].sort((a,b)=>b.v-a.v);
    const top2 = [order[0].i, order[1].i];
    top2.forEach(ci => tr.querySelectorAll('td.pick')[ci].classList.add('sel'));
  });
};
el('btnOneTrpl').onclick=()=>{
  const tr = tbody.querySelector('tr'); if(!tr) return;
  tr.querySelectorAll('td.pick').forEach(td=>td.classList.add('sel'));
};

/* ==== –ê–í–¢–û–°–ò–ù–•–†–û–ù ==== */
let timer=null;
el('autoSync').addEventListener('change',()=>{
  if(el('autoSync').checked){
    timer=setInterval(()=>{
      const id=(el('draw').value||'').trim(); if(id){ loadTB(id); }
    }, 5*60*1000);
    el('syncStatus').textContent = `–°—Ç–∞—Ç—É—Å: üü° –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞ ‚Ä¢ ${nowStr()}`;
  }else{
    clearInterval(timer); timer=null;
    el('syncStatus').textContent = `–°—Ç–∞—Ç—É—Å: ‚è∏ –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—ã–∫–ª—é—á–µ–Ω–∞`;
  }
});

/* ==== –°–¢–ê–†–¢ ==== */
renderGrid([]);
</script>
</body>
</html>
